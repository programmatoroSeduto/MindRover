<?php

$data = array();

echo '<br><br>';
echo '>> --- IMPORTAZIONE Account utente --- <<';
echo '<br><br><br><br><br>';





















/*
$data[] = array(
    'credenziali' => array(
        'email' => '',
        'password' => ''
    ),
    'profilo' => array(
        'nickname' => '',
        'nome' => '',
        'cognome' => '',
        'stato' => '',
        'descrizione' => '',
        'flag_anonimo' => false,
        'id_img_profilo' => -1
    ),
    'donazioni' => array()
);
*/

$data[] = array(
    'credenziali' => array(
        'email' => 'a@b.c',
        'password' => 'abc'
    ),
    'profilo' => array(
        'nickname' => 'signorSignaro',
        'nome' => 'Bella',
        'cognome' => 'Greg',
        'stato' => 'la password è abc.',
        'descrizione' => 'nient\'altro da aggiungere ... bella greg.',
        'flag_anonimo' => false,
        'id_img_profilo' => 4
    ),
    'donazioni' => array(500, 250, 300, 24)
);

$data[] = array(
    'credenziali' => array(
        'email' => 'test@test.t',
        'password' => 'test'
    ),
    'profilo' => array(
        'nickname' => 'BellaGreg',
        'nome' => 'Bella',
        'cognome' => 'Greg',
        'stato' => 'Bella greg?',
        'descrizione' => 'Bella greg.',
        'flag_anonimo' => false,
        'id_img_profilo' => -1
    ),
    'donazioni' => array(500, 250, 300, 24)
);

$data[] = array(
    'credenziali' => array(
        'email' => 'pelata.lucente@hotmail.com',
        'password' => 'password'
    ),
    'profilo' => array(
        'nickname' => 'xXxPelataLucentexXx',
        'nome' => 'Fernando',
        'cognome' => 'Cartomastro',
        'stato' => 'Dal mattino alla sera, bella Lore bella Rena!',
        'descrizione' => 'La mia pelata è lucente',
        'flag_anonimo' => false,
        'id_img_profilo' => -1
    ),
    'donazioni' => array(1, 2, 3, 4)
);

$data[] = array(
    'credenziali' => array(
        'email' => 'c.asdrubale@gmail.it',
        'password' => 'ringhiera'
    ),
    'profilo' => array(
        'nickname' => 'PetardoIndiano777',
        'nome' => 'Francesco',
        'cognome' => 'Asdrubale',
        'stato' => 'Ciccio Asdrubale sta arrivando!',
        'descrizione' => 'Sono Ciccio, ho 43 anni, vivo con mia madre e mangio gli hamburger.',
        'flag_anonimo' => false,
        'id_img_profilo' => -1
    ),
    'donazioni' => array()
);

$data[] = array(
    'credenziali' => array(
        'email' => 'cangrande@live.it',
        'password' => 'dantesuca'
    ),
    'profilo' => array(
        'nickname' => 'xxBIGDOG',
        'nome' => 'Cangrande',
        'cognome' => 'Della Scala',
        'stato' => 'Niente Paradiso per me, eh?',
        'descrizione' => 'Sono un ricco figlio di papà arrabbiato con Dante.',
        'flag_anonimo' => false,
        'id_img_profilo' => -1
    ),
    'donazioni' => array()
);

$data[] = array(
    'credenziali' => array(
        'email' => 'cliff.unger@gmail.us',
        'password' => 'bb'
    ),
    'profilo' => array(
        'nickname' => 'CombatVeteran',
        'nome' => 'Cliff',
        'cognome' => 'Unger',
        'stato' => 'Dov\'è il mio BB?',
        'descrizione' => 'Fa ridere perchè Cliff Unger sembra "cliffhanger", e la mia identità è proprio un colpo di scena.',
        'flag_anonimo' => false,
        'id_img_profilo' => 32
    ),
    'donazioni' => array(60, 10, 20, 800, 760, 40)
);

$data[] = array(
    'credenziali' => array(
        'email' => 'lorenzo.terranova96@hotmail.com',
        'password' => 'lorenzo96'
    ),
    'profilo' => array(
        'nickname' => 'Kallaari',
        'nome' => 'Lorenzo',
        'cognome' => 'Terranova',
        'stato' => '"This time I finally let you... Go."',
        'descrizione' => 'Stavo tenendo conto di ogni mia colazione ma alla fine mi sono stancato, basta.',
        'flag_anonimo' => false,
        'id_img_profilo' => 15
    ),
    'donazioni' => array(6, 12, 24, 48, 76)
);

$data[] = array(
    'credenziali' => array(
        'email' => 'peppinodellapeppa@libero.it',
        'password' => 'peppomelopeppi'
    ),
    'profilo' => array(
        'nickname' => 'pep_PINO',
        'nome' => 'Giuseppe',
        'cognome' => 'Inguastato',
        'stato' => '"Ci sono molte cose che mi piacciono, ma IL QUADRO è ciò che mi ispira."',
        'descrizione' => 'Mi chiamo Giuseppe però le arance me le infilo nel baule lo stesso.',
        'flag_anonimo' => false,
        'id_img_profilo' => 14
    ),
    'donazioni' => array(600, 120, 200, 40, 700, 1)
);

$data[] = array(
    'credenziali' => array(
        'email' => 'tentennatoRiazza@albergo.frutta',
        'password' => 'repartoortofrutta'
    ),
    'profilo' => array(
        'nickname' => 'Lil\'ShoezZz',
        'nome' => 'Nicola',
        'cognome' => 'Scarpino',
        'stato' => '"Qualcuno ha detto SCARPA?"',
        'descrizione' => 'Mi piacciono le scarpe, gli scarponi, gli scarpini, i sandali, le infradito, il matto, e i nani da giardino di Giulia.',
        'flag_anonimo' => false,
        'id_img_profilo' => 11
    ),
    'donazioni' => array(600, 100, 200, 40, 10, 1)
);

$data[] = array(
    'credenziali' => array(
        'email' => 'aragosta@irachena.it',
        'password' => 'arachenairagosta'
    ),
    'profilo' => array(
        'nickname' => 'AragostaIrachena',
        'nome' => 'Peter',
        'cognome' => 'Griffin',
        'stato' => '"Non bollitemi, sono ancora viva!"',
        'descrizione' => 'Aragosta Irachena! Aragosta Irachena! Aragosta Irachena! Aragosta Irachena! Aragosta Irachena! Aragosta Irachena! ',
        'flag_anonimo' => false,
        'id_img_profilo' => 15
    ),
    'donazioni' => array(120, 150, 200, 480, 20, 1)
);

$data[] = array(
    'credenziali' => array(
        'email' => 'programmatoroseduto.kungkurth@frogstudios.com',
        'password' => 'belladomanda'
    ),
    'profilo' => array(
        'nickname' => 'KungKurth',
        'nome' => 'Francesco',
        'cognome' => 'Ganci',
        'stato' => '"Ci penso, ci penso..."',
        'descrizione' => '"Ci penso... Dai quelle le metto io poi..."',
        'flag_anonimo' => false,
        'id_img_profilo' => 28
    ),
    'donazioni' => array(900, 750, 800, 180.50, 20.50, 100)
);

$data[] = array(
    'credenziali' => array(
        'email' => 'moc.soidutsgorf@htrukgnuk.otudesorotammargorp',
        'password' => 'adnamodalleb'
    ),
    'profilo' => array(
        'nickname' => 'HtrukGnuk',
        'nome' => 'Grancesco',
        'cognome' => 'Fanci',
        'stato' => '"Non ci penso, non ci penso..."',
        'descrizione' => '"Non ci penso... Dai quelle non le metto io poi..."',
        'flag_anonimo' => false,
        'id_img_profilo' => 29
    ),
    'donazioni' => array(9, 57, 8, 5.8, 5.2, 1)
);

$data[] = array(
    'credenziali' => array(
        'email' => 'giulia.stella@gmail.com',
        'password' => 'nonloso'
    ),
    'profilo' => array(
        'nickname' => 'GiuliaStella05',
        'nome' => 'Giulia',
        'cognome' => 'Stella',
        'stato' => '"<3"',
        'descrizione' => 'Sono una trippona che tiene segreta la sua vera identità...',
        'flag_anonimo' => false,
        'id_img_profilo' => 31
    ),
    'donazioni' => array(230, 30, 20)
);










require_once('./mysql_credentials.php');
require_once('./CredenzialiUtenti.php');
require_once('./ProfiliUtenti.php');
require_once('./Donazioni.php');
require_once('./ImgProfilo.php');
require_once('./../utils/hashMethods.php');
require_once('./../utils/sanitize_input.php');
$dbms = connect(true);
$hash = new HashMethods();

//connessione col database
$table_credenziali = new CredenzialiUtenti($dbms, $hash);
$table_profili = new ProfiliUtenti($dbms);
$table_donazioni = new Donazioni($dbms);
$table_stili = new ImgProfilo($dbms);
$id_stili = array_map(function($elem){return $elem['id'];}, $table_stili->getAllStyles());

$i = 1;
foreach($data as $k)
{
    echo '--- (' . $i . ') ---';

    if($table_credenziali->isSetEmail($k['credenziali']['email']))
    {
        echo 'la mail esiste già: ' . $k['credenziali']['email'] . '<br>';
        continue;
    }

    if($table_profili->getIdByNickname($k['profilo']['nickname']) >= 0)
    {
        echo 'nickname ' . $k['profilo']['nickname'] . 'già presente nel database. <br>';
        continue;
    }

    if($table_credenziali->createAccount($k['credenziali']['email'], $hash->getHash($k['credenziali']['password'])) === -1)
    {
        echo "errore: " . $dbms->errno . ' ' . $dbms->error;
        continue;
    }
    $id_profilo = $table_credenziali->getId($k['credenziali']['email'], $k['credenziali']['password']);
    $id_img = $id_stili[$i];
    if($k['profilo']['id_img_profilo'] >= 0)
    {
        $id_img = $k['profilo']['id_img_profilo'];
    }
    else
    {
        $i++;
    }
    if($errcode = $table_profili->createAccount($id_profilo, $k['profilo']['nickname'], $k['profilo']['nome'], $k['profilo']['cognome'], $id_img))
    {
        echo "errore: " . $dbms->errno . ' ' . $dbms->error;
        continue;
    }
    $supporter = false;
    if(count($k['donazioni']) > 0)
    {
        $table_profili->setSupporter($id_profilo, true);
        $supporter = true;
    }
    $table_profili->setStatus($id_profilo, $k['profilo']['stato']);
    $table_profili->setDescription($id_profilo, $k['profilo']['descrizione']);
    if($k['profilo']['flag_anonimo'])
    {
        $table_profili->setAnonymous($id_profilo, true);
    }

    if($supporter)
    {
        echo '<br>';
        foreach($k['donazioni'] as $amount)
        {
            echo $table_donazioni->recordDonation($id_profilo, $amount) . '<br>';
        }
    }
}

echo '<br><br>';
echo '>> --- IMPORTAZIONE Account utente TERMINATA --- <<';
echo '<br><br><br><br><br>';

?>